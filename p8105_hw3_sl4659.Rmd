---
title: "p8105_hw3_sl4659"
author: "Shenglin Liu"
date: "10/9/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Problem 1

The dataset contains 1,384,617 observations of 131,209 unique users, where each row in the dataset is a product from an order. There is a single order per user in this dataset. There are 15 variables in the dataset. The variable reordered is 1 if this prodcut has been ordered by this user in the past, 0 otherwise. The variable order_dow identifies the day of the week on which the order was placed. The variable order_hour_of_day identifies the hour of the day on which the order was placed. In addition, product_name, aisle, and department are all key variables. Let's take the third observation as an example. It shows that user with id 112108 ordered organic celery hearts in the fresh vegetables aisle under the produce department. The order was at 10 on Thursday and it has been 9 days since the user's last order. It is also the first time this user ordered this product.

```{r Problem1P1}
library(tidyverse)
library(grid)
library(gridExtra)
library(arsenal)
library(data.table)
library(p8105.datasets)

# load instacart dataset
data(instacart)
# create a tibble for matching pairs of aisle_id and aisle
aisle_pair = distinct(instacart, aisle_id, aisle)
aisle_pair = arrange(aisle_pair, aisle_id)
# create a tibble for aisle_id frequency counts
aisle_fre = count(instacart, aisle_id)
# join dataframes aisle_fre and aisle_pair
aisle_df = left_join(aisle_pair, aisle_fre)
aisle_df = arrange(aisle_df, desc(n))
```
There are `r nrow(aisle_fre)` aisles. Top 5 aisles that the most items are ordered from: `r aisle_df$aisle[1]`, `r aisle_df$aisle[2]`, `r aisle_df$aisle[3]`, `r aisle_df$aisle[4]`, `r aisle_df$aisle[5]`.

```{r Problem1P2}
aisle_10000 = filter(aisle_df, n > 10000)
# Basic barplot
ggplot(data = aisle_10000, aes(x = reorder(aisle, n), y = n, fill = "red")) +
  geom_bar(stat = "identity") + 
# horizontal barplot
  coord_flip() +
  guides(fill = FALSE) +
# title, label and caption
  labs(
    title = "Aisles with more than 10000 items ordered",
    x = "Aisle",
    y = "Number of items ordered",
    caption = "Data from p8105.datasets"
  )
```

```{r Problem1P3}
# create a tibble for baking ingredients frequency counts and select top 3
bi_df = filter(instacart, aisle == "baking ingredients")
bi_fre = count(bi_df, product_name)
bi_fre$aisle = "baking ingredients"
bi_fre = arrange(bi_fre, desc(n))
bi_top3 = bi_fre[1:3,]
# create a tibble for dog food care frequency counts and select top 3
dfc_df = filter(instacart, aisle == "dog food care")
dfc_fre = count(dfc_df, product_name)
dfc_fre$aisle = "dog food care"
dfc_fre = arrange(dfc_fre, desc(n))
dfc_top3 = dfc_fre[1:3,]
# create a tibble for packaged vegetables fruits frequency counts and select top 3
pvf_df = filter(instacart,aisle == "packaged vegetables fruits")
pvf_fre = count(pvf_df, product_name)
pvf_fre$aisle = "packaged vegetables fruits"
pvf_fre = arrange(pvf_fre, desc(n))
pvf_top3 = pvf_fre[1:3,]
# merge vertically and reorder columns
top3_df = rbind(bi_top3, dfc_top3, pvf_top3)
top3_df = top3_df[c(3,1,2)]
# create subsets for three aisles
d1 = top3_df[1:3,]
d2 = top3_df[4:6,]
d3 = top3_df[7:9,]
# create three separate gridtables for each aisle
g1 = tableGrob(d1)
g2 = tableGrob(d2)
g3 = tableGrob(d3)
# combine gridtables
g = gtable_combine(g1, g2, g3, along = 2)
grid.draw(g)
```

```{r Problem1P4}
# create two separate dataframes for pink lady apples and coffee ice cream
pla_df = filter(instacart, product_name == "Pink Lady Apples") 
cic_df = filter(instacart, product_name == "Coffee Ice Cream")
# compute means on each day of the week
tb1_df = tibble(
  vec_pla = c(round(mean(filter(pla_df, order_dow == 0)$order_hour_of_day), 2), round(mean(filter(pla_df, order_dow == 1)$order_hour_of_day), 2), round(mean(filter(pla_df, order_dow == 2)$order_hour_of_day), 2), round(mean(filter(pla_df, order_dow == 3)$order_hour_of_day), 2), round(mean(filter(pla_df, order_dow == 4)$order_hour_of_day), 2), round(mean(filter(pla_df, order_dow == 5)$order_hour_of_day), 2), round(mean(filter(pla_df, order_dow == 6)$order_hour_of_day), 2)),
  vec_cic = c(round(mean(filter(cic_df, order_dow == 0)$order_hour_of_day), 2), round(mean(filter(cic_df, order_dow == 1)$order_hour_of_day), 2), round(mean(filter(cic_df, order_dow == 2)$order_hour_of_day), 2), round(mean(filter(cic_df, order_dow == 3)$order_hour_of_day), 2), round(mean(filter(cic_df, order_dow == 4)$order_hour_of_day), 2), round(mean(filter(cic_df, order_dow == 5)$order_hour_of_day), 2), round(mean(filter(cic_df, order_dow == 6)$order_hour_of_day), 2))
) 
colnames(tb1_df) <- c("Pink Lady Apples", "Coffee Ice Cream")
rownames(tb1_df) <- c("Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat")
grid.table(t(tb1_df))
```

## Problem 2
```{r Tidy}
data(brfss_smart2010)
# format the data to use appropriate variable names
brfss = janitor::clean_names(brfss_smart2010)
# focus on the “Overall Health” topic
brfss = filter(brfss, topic == "Overall Health")
# include only responses from “Excellent” to “Poor”
brfss = filter(brfss, response == "Excellent" | response == "Very good" | response == "Good" | response == "Fair" | response == "Poor")
# organize responses as a factor taking levels ordered from “Poor” to “Excellent”
brfss$response = as.factor(brfss$response)
brfss$response = factor(brfss$response, levels = c("Poor", "Fair", "Good", "Very good", "Excellent"))
```

```{r Problem2P1}
# create a dataframe for year 2002
brfss_2002 = filter(brfss, year == 2002)
# find distinct pairs of locationabbr and locationdesc
state_2002 = distinct(brfss_2002, locationabbr, locationdesc)
# create a tibble for location frequency counts
state_2002 = count(state_2002, locationabbr)
state_2002 = filter(state_2002, n >= 7)
# create a dataframe for year 2010
brfss_2010 = filter(brfss, year == 2010)
# find distinct pairs of locationabbr and locationdesc
state_2010 = distinct(brfss_2010, locationabbr, locationdesc)
# create a tibble for location frequency counts
state_2010 = count(state_2010, locationabbr)
state_2010 = filter(state_2010, n >= 7)
```
These states were observed at 7 or more locations in 2002: `r state_2002$locationabbr`. These states were observed at 7 or more locations in 2010: `r state_2010$locationabbr`.

```{r Problem2P2}
# construct a dataset that is limited to Excellent responses
brfss_spa = filter(brfss, response == "Excellent")
# contain year and state
brfss_spa = select(brfss_spa, year, locationabbr, data_value)
brfss_spa = drop_na(brfss_spa, data_value)
keys = colnames(brfss_spa)[!grepl('data_value', colnames(brfss_spa))]
X = as.data.table(brfss_spa)
brfss_spa = X[,list(mean_value = mean(data_value)),keys]
# multiple groups with one aesthetic
ggplot(data = brfss_spa, aes(x = year, y = mean_value)) + 
# the group aesthetic maps a different line for each subject
  geom_line(aes(group = locationabbr)) +
  geom_line(aes(colour = factor(locationabbr)))  +
# title, label and caption
  labs(
    title = "Average data_value over time within individual states",
    x = "Year",
    y = "Value",
    caption = "Data from p8105.datasets"
  )
```

```{r Problem2P3}
# construct a dataset that is limited to locations in NY State
brfss_tp = filter(brfss, locationabbr == "NY")
# constrct a dataset that is limited to year 2006 and 2010
brfss_tp = filter(brfss_tp, year == 2006 | year == 2010)
ggplot(data = brfss_tp, aes(x = response, y = data_value)) +
  geom_boxplot() +
# facet into columns based on year
  facet_grid(. ~ year) +
# title, label and caption
  labs(
    title = "Boxplot of data_value for responses in NY State in Year 2006 and 2010",
    x = "Response",
    y = "Value",
    caption = "Data from p8105.datasets"
  )
```




